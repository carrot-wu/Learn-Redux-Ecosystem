Wu82389217,

wu82389217

获取k8s token
https://jimmysong.io/kubernetes-handbook/guide/auth-with-kubeconfig-or-token.html

eyJhbGciOiJSUzI1NiIsImtpZCI6InZvX00zLUZ1ejJkdzRLWmxwNHhiMFZ5YW5Edl9HVUpFUUVJSEhJMEZ3dDgifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi10b2tlbi1rYnJqOSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJhZG1pbiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjQxNjk2ZjI4LTQ1ODktNDBhZC04NWRiLTRmNGIxMzQ4MmU2OCIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlLXN5c3RlbTphZG1pbiJ9.JCV8QmNVLll5fRWNcLdpbzkdQcaWM3Rx7-CbRn1SFeSXz52Gr8_O9lnlm6h18-fw4dOq0T0EG2dNOSAyJBbHn7mTm4iDSRQGq5H0dgR4_GWYiTTXlPBV842bBynhZSv-4vz8Pb6rFbfzjIMTBW4gX-irB1vQ9iJHtXUcZJecaGugmstNOIqsy5cQlmY_Y2Wynn3Ea6lMbNWd0Fiu9VfWX2Y0xagKMS11CAF2ZhKrjJIFg6SrVAJse6fqKMmh_mGfE6w1Mq8bekf-HqKg-jDTCWH6j4N9MrPzsAUFTu-kXzccMlmwthX5SNFjpf3wS6SkOAYQpwLSOs2iJKY-xfkNog

## 生成kubernetes集群最高权限admin用户的token

```js
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1beta1
metadata:
  name: admin
  annotations:
    rbac.authorization.kubernetes.io/autoupdate: "true"
roleRef:
  kind: ClusterRole
  name: cluster-admin
  apiGroup: rbac.authorization.k8s.io
subjects:
- kind: ServiceAccount
  name: admin
  namespace: kube-system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: admin
  namespace: kube-system
  labels:
    kubernetes.io/cluster-service: "true"
    addonmanager.kubernetes.io/mode: Reconcile
```
kubectl create -f admin-role.yaml

kubectl -n kube-system get secret|grep admin-token

kubectl -n kube-system describe secret admin-token-nwphb

kubectl describe secret admin-token-nwphb
需要创建一个admin用户并授予admin角色绑定，使用下面的yaml文件创建admin用户并赋予他管理员权限，然后可以通过token访问kubernetes，该文件见admin-role.yaml。


k8sServer https://172.17.16.12:6443 

获取k8s cert
kubectl get secrets
 首先获取secrets名
kubectl get secret 【default-token-h75k7 secret名】 -o jsonpath='{.data.ca\.crt}' && echo

实际使用
cat $HOME/.kube/config 拿certificate-authority-data的值

LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM1ekNDQWMrZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJeE1ETXdNakEzTURNeU1Wb1hEVE14TURJeU9EQTNNRE15TVZvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTUNwCk5YWlBNTEs4R1ZXYURNTlE1bGRQV3pCaXRMeEpSOHA3U01YUU8yK0lFUVBiaFhUYncyNThIUTF0RzhVS2l4VSsKanNJT3BZSDJSYnB0UXZHWTQxaERpVjBGRDdORWJGSEwzbk1hM1ZYZmk5blB4Q3p6bW1FWFBQbGlvZm1FMzkragpnRzhiU2pEcWhCZmprM29Hd2N0eXhvYVVsbjZCRkRlc3cvN1RQemRkZ25YYk9UNk82MzBJMHFzYjJjUTB3TXpTCnhDVDRSb2tVOEM3Y0VvYUl1QXBYejhDaVI5TFErUENWRXVPZGRSbGJlNUVsOFJ4ZkNPZVV2RzB5L0FPeXlwVGwKVUw1eFB4T1BlblpZbzRZZ0s5QlhNVTh6WFZ5UnJObVRadGRUREtKRjVYcmNueHFmd0k4dkV6SmpRMWZPdTd6VQpEN2E2TEtRakhuelg3dm5MNTg4Q0F3RUFBYU5DTUVBd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZIbkoveTFPYnpaRlhpR0I5WDl0UjNPMWExaFJNQTBHQ1NxR1NJYjMKRFFFQkN3VUFBNElCQVFCdUVMYzRMVlhFY3FaWWF3M0w5ZUZvYlc5MzFjRm82ZDdVL2JCRkllUXlBc1htQzNDdApVWFRtQ0ZsaU5iejMrbjlBcWlOVEJPWU9rdnlOWHd3WkpNMzVNZWpIWmNtTWJIYlkxQzdmUjE2eWtiWEoreGtyCnlrY1RkTElKY0J5V2JNdFkxV1kweTZMRnUwck9qZTFFb09lYlZqVjgwL3g4S1NyNlNpOFZuYzJjVTlCK2ZhTmUKWDgyWGFPejVqWHVHM3E4NlRoblZ4WEsvYk9CN3dmQk80cDVabjd6OU1yb1RUd21NR1JDekJlbEZ3YXlhSXFicAo3V0JmMlk3VGVVb3BMaTd5UjhHb0ZDOWJ2NDhXTjlXK0pHd3IzaURJMzlNaU5nTTdnQkp1WnpqeTlxMzNIWW03CjRxK0REazNDNk4xWnZlKzdFbGY2YjZmTUgxRUJWd0o3LzNaNAotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==



127.0.0.1 VM_0_10_centos VM_0_10_centos
127.0.0.1 localhost.localdomain localhost
127.0.0.1 localhost4.localdomain4 localhost4

140.82.114.4 github.com

::1 VM_0_10_centos VM_0_10_centos
::1 localhost.localdomain localhost
::1 localhost6.localdomain6 localhost6